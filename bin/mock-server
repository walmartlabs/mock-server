#!/usr/bin/env node

var args = process.argv.slice(2);
if (args.length !== 5 && args.length !== 4 && args.length !== 2) {
  console.error('Usage: mock-server appDir proxyServer [port securePort] [--live-reload]');
  process.exit(1);
  return;
}

var config = require('../lib/config');
config.isHeroku = args[0] === 'heroku';
config.appDir = config.isHeroku ? '/tmp/mock-server' : args[0];
config.proxyServer = args[1];
config.port = parseInt(args[2] || process.env.PORT || 8080);
config.forwardPort = parseInt(args[2] || (config.isHeroku ? 80 : config.port));
config.securePort = parseInt(args[3] || (config.isHeroku ? 443 : 8081));
config.liveReload = args[4] && args[4] === '--live-reload';

// Ensure that node is available on the path
if (config.isHeroku) {
  process.env.PATH = __dirname + '/../bin/:' + process.env.PATH;
}

// Start up
require('../lib');
